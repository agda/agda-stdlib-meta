<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Tactic.Eta</title><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css'/><style>.github-fork-ribbon:before { background-color: #333; }</style><link rel="stylesheet" href="css/Agda.css"></head><body><a class='github-fork-ribbon'href='https://github.com/omelkonian/agda-stdlib-meta/tree/master///Tactic/Eta.agda'data-ribbon='Source code on Github' title='Source code on Github'>Source code on Github</a><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--safe</a> <a id="20" class="Pragma">--without-K</a> <a id="32" class="Symbol">#-}</a>
<a id="36" class="Comment">--------------------------------------------------------------------------------</a>
<a id="117" class="Comment">-- eta: unify with an eta-expanded version of the argument</a>
<a id="176" class="Comment">--------------------------------------------------------------------------------</a>

<a id="258" class="Keyword">module</a> <a id="265" href="Tactic.Eta.html" class="Module">Tactic.Eta</a> <a id="276" class="Keyword">where</a>

<a id="283" class="Keyword">open</a> <a id="288" class="Keyword">import</a> <a id="295" href="MetaPrelude.html" class="Module">MetaPrelude</a>
<a id="307" class="Keyword">open</a> <a id="312" class="Keyword">import</a> <a id="319" href="Meta.html" class="Module">Meta</a>

<a id="325" class="Keyword">open</a> <a id="330" class="Keyword">import</a> <a id="337" href="Data.List.html" class="Module">Data.List</a>
<a id="347" class="Keyword">open</a> <a id="352" class="Keyword">import</a> <a id="359" href="Data.Fin.html" class="Module">Data.Fin</a>

<a id="369" class="Keyword">open</a> <a id="374" class="Keyword">import</a> <a id="381" href="Class.Monad.html" class="Module">Class.Monad</a>
<a id="393" class="Keyword">open</a> <a id="398" class="Keyword">import</a> <a id="405" href="Class.MonadTC.Instances.html" class="Module">Class.MonadTC.Instances</a>
<a id="429" class="Keyword">open</a> <a id="434" class="Keyword">import</a> <a id="441" href="Class.Semigroup.html" class="Module">Class.Semigroup</a>
<a id="457" class="Keyword">open</a> <a id="462" class="Keyword">import</a> <a id="469" href="Class.Show.html" class="Module">Class.Show</a>

<a id="481" class="Keyword">open</a> <a id="486" class="Keyword">import</a> <a id="493" href="Reflection.Tactic.html" class="Module">Reflection.Tactic</a>
<a id="511" class="Keyword">open</a> <a id="516" class="Keyword">import</a> <a id="523" href="Reflection.Utils.html" class="Module">Reflection.Utils</a>
<a id="540" class="Keyword">open</a> <a id="545" class="Keyword">import</a> <a id="552" href="Reflection.Utils.TCI.html" class="Module">Reflection.Utils.TCI</a>

<a id="saturate"></a><a id="574" href="Tactic.Eta.html#574" class="Function">saturate</a> <a id="583" class="Symbol">:</a> <a id="585" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="590" class="Symbol">→</a> <a id="592" href="Reflection.AST.Argument.html#1604" class="Function">Args</a> <a id="597" href="Agda.Builtin.Reflection.html#5064" class="Function">Type</a> <a id="602" class="Symbol">→</a> <a id="604" href="Reflection.TCI.html#616" class="Function">TC</a> <a id="607" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a>
<a id="612" href="Tactic.Eta.html#574" class="Function">saturate</a> <a id="621" href="Tactic.Eta.html#621" class="Bound">f</a> <a id="623" href="Tactic.Eta.html#623" class="Bound">as</a> <a id="626" class="Symbol">=</a> <a id="628" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="633" href="Tactic.Eta.html#621" class="Bound">f</a> <a id="635" href="Function.Base.html#4042" class="Function Operator">of</a> <a id="638" class="Symbol">λ</a> <a id="640" class="Keyword">where</a>
  <a id="648" class="Symbol">(</a><a id="649" href="Agda.Builtin.Reflection.html#5251" class="InductiveConstructor">def</a> <a id="653" href="Tactic.Eta.html#653" class="Bound">c</a> <a id="655" href="Tactic.Eta.html#655" class="Bound">as′</a><a id="658" class="Symbol">)</a> <a id="660" class="Symbol">→</a> <a id="662" href="Class.Monad.Core.html#269" class="Field">return</a> <a id="669" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="671" href="Agda.Builtin.Reflection.html#5251" class="InductiveConstructor">def</a> <a id="675" href="Tactic.Eta.html#653" class="Bound">c</a> <a id="677" class="Symbol">(</a><a id="678" href="Tactic.Eta.html#655" class="Bound">as′</a> <a id="682" href="Data.List.Base.html#1954" class="Function Operator">++</a> <a id="685" href="Tactic.Eta.html#623" class="Bound">as</a><a id="687" class="Symbol">)</a>
  <a id="691" class="CatchallClause Symbol">_</a>           <a id="703" class="Symbol">→</a> <a id="705" href="Class.MonadTC.html#8767" class="Function">error1</a> <a id="712" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="714" class="String">&quot;cannot saturate arbitrary expressions, only definitions&quot;</a>

<a id="773" class="Keyword">macro</a>
  <a id="η"></a><a id="781" href="Tactic.Eta.html#781" class="Function">η</a> <a id="783" class="Symbol">:</a> <a id="785" class="Symbol">⦃</a> <a id="787" href="Class.MonadTC.html#618" class="Record">TCOptions</a> <a id="797" class="Symbol">⦄</a> <a id="799" class="Symbol">→</a> <a id="801" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="806" class="Symbol">→</a> <a id="808" href="Reflection.Tactic.html#489" class="Function">Tactic</a>
  <a id="817" href="Tactic.Eta.html#781" class="Function">η</a> <a id="819" href="Tactic.Eta.html#819" class="Bound">f</a> <a id="821" class="Symbol">=</a> <a id="823" href="Reflection.Tactic.html#837" class="Function">initTac</a> <a id="831" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="833" href="Reflection.Utils.TCI.html#5945" class="Function">inDebugPath</a> <a id="845" class="String">&quot;eta&quot;</a> <a id="851" class="Keyword">do</a>
    <a id="858" href="Class.MonadTC.html#5769" class="Function">debugLog</a> <a id="867" class="Symbol">(</a><a id="868" class="String">&quot;f: &quot;</a> <a id="874" href="Reflection.Debug.html#1014" class="Function Operator">∷ᵈ</a> <a id="877" href="Tactic.Eta.html#819" class="Bound">f</a> <a id="879" href="Reflection.Debug.html#1014" class="Function Operator">∷ᵈ</a> <a id="882" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="884" class="Symbol">)</a>
    <a id="890" href="Tactic.Eta.html#890" class="Bound">ty</a> <a id="893" href="Class.Monad.Core.html#290" class="Field Operator">←</a> <a id="895" href="Class.MonadTC.html#1750" class="Field">inferType</a> <a id="905" href="Tactic.Eta.html#819" class="Bound">f</a> <a id="907" class="Comment">-- =&lt;&lt; reduce f</a>
    <a id="927" href="Class.MonadTC.html#5769" class="Function">debugLog</a> <a id="936" class="Symbol">(</a><a id="937" class="String">&quot;ty: &quot;</a> <a id="944" href="Reflection.Debug.html#1014" class="Function Operator">∷ᵈ</a> <a id="947" href="Tactic.Eta.html#890" class="Bound">ty</a> <a id="950" href="Reflection.Debug.html#1014" class="Function Operator">∷ᵈ</a> <a id="953" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="955" class="Symbol">)</a>
    <a id="961" class="Keyword">let</a> <a id="965" href="Tactic.Eta.html#965" class="Bound">as</a> <a id="968" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="970" class="Symbol">_</a> <a id="972" class="Symbol">=</a> <a id="974" href="Reflection.Utils.html#2821" class="Function">viewTy′</a> <a id="982" href="Tactic.Eta.html#890" class="Bound">ty</a>
    <a id="989" href="Class.MonadTC.html#5769" class="Function">debugLog</a> <a id="998" class="Symbol">(</a><a id="999" class="String">&quot;as: &quot;</a> <a id="1006" href="Reflection.Debug.html#1014" class="Function Operator">∷ᵈ</a> <a id="1009" href="Class.Show.Core.html#178" class="Field">show</a> <a id="1014" href="Tactic.Eta.html#965" class="Bound">as</a> <a id="1017" href="Reflection.Debug.html#1014" class="Function Operator">∷ᵈ</a> <a id="1020" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1022" class="Symbol">)</a>
    <a id="1028" href="Tactic.Eta.html#1028" class="Bound">f′</a> <a id="1031" href="Class.Monad.Core.html#290" class="Field Operator">←</a> <a id="1033" href="Tactic.Eta.html#574" class="Function">saturate</a> <a id="1042" href="Tactic.Eta.html#819" class="Bound">f</a> <a id="1044" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1046" href="Function.Base.html#1638" class="Function">flip</a> <a id="1051" href="Data.List.Base.html#1631" class="Function">map</a> <a id="1055" class="Symbol">(</a><a id="1056" href="MetaPrelude.html#1217" class="Function">enumerate</a> <a id="1066" href="Tactic.Eta.html#965" class="Bound">as</a><a id="1068" class="Symbol">)</a> <a id="1070" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1072" class="Symbol">λ</a> <a id="1074" class="Keyword">where</a>
      <a id="1086" class="Symbol">(</a><a id="1087" href="Tactic.Eta.html#1087" class="Bound">n</a> <a id="1089" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1091" href="Agda.Builtin.Reflection.html#3732" class="InductiveConstructor">arg</a> <a id="1095" href="Tactic.Eta.html#1095" class="Bound">i</a> <a id="1097" class="Symbol">_)</a> <a id="1100" class="Symbol">→</a> <a id="1102" href="Agda.Builtin.Reflection.html#3732" class="InductiveConstructor">arg</a> <a id="1106" href="Tactic.Eta.html#1095" class="Bound">i</a> <a id="1108" class="Symbol">(</a><a id="1109" href="Reflection.Syntax.html#1452" class="InductiveConstructor">♯</a> <a id="1111" class="Symbol">(</a><a id="1112" href="Data.List.Base.html#5083" class="Function">length</a> <a id="1119" href="Tactic.Eta.html#965" class="Bound">as</a> <a id="1122" href="Data.Nat.Base.html#4456" class="Primitive Operator">∸</a> <a id="1124" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="1128" href="Tactic.Eta.html#1087" class="Bound">n</a><a id="1129" class="Symbol">))</a>
    <a id="1136" href="Class.MonadTC.html#5769" class="Function">debugLog</a> <a id="1145" class="Symbol">(</a><a id="1146" class="String">&quot;f′: &quot;</a> <a id="1153" href="Reflection.Debug.html#1014" class="Function Operator">∷ᵈ</a> <a id="1156" href="Class.Show.Core.html#178" class="Field">show</a> <a id="1161" href="Tactic.Eta.html#1028" class="Bound">f′</a> <a id="1164" href="Reflection.Debug.html#1014" class="Function Operator">∷ᵈ</a> <a id="1167" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1169" class="Symbol">)</a>
    <a id="1175" href="Class.MonadTC.html#10517" class="Function">unifyWithGoal</a> <a id="1189" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1191" href="Data.List.Base.html#4336" class="Function">foldr</a> <a id="1197" class="Symbol">(λ</a> <a id="1200" href="Tactic.Eta.html#1200" class="Bound">x</a> <a id="1202" href="Tactic.Eta.html#1202" class="Bound">t</a> <a id="1204" class="Symbol">→</a> <a id="1206" href="Reflection.AST.Term.html#2283" class="InductiveConstructor Operator">Π[</a> <a id="1209" class="String">&quot;_&quot;</a> <a id="1213" href="Reflection.AST.Term.html#2283" class="InductiveConstructor Operator">∶</a> <a id="1215" href="Tactic.Eta.html#1200" class="Bound">x</a> <a id="1217" href="Reflection.AST.Term.html#2283" class="InductiveConstructor Operator">]</a> <a id="1219" href="Tactic.Eta.html#1202" class="Bound">t</a><a id="1220" class="Symbol">)</a> <a id="1222" href="Tactic.Eta.html#1028" class="Bound">f′</a> <a id="1225" href="Tactic.Eta.html#965" class="Bound">as</a>


<a id="1230" class="Keyword">private</a>
  <a id="1240" class="Keyword">module</a> <a id="Test"></a><a id="1247" href="Tactic.Eta.html#1247" class="Module">Test</a> <a id="1252" class="Keyword">where</a>
    <a id="1262" class="Keyword">open</a> <a id="1267" class="Keyword">import</a> <a id="1274" href="Tactic.Defaults.html" class="Module">Tactic.Defaults</a>

    <a id="Test.p"></a><a id="1295" href="Tactic.Eta.html#1295" class="Function">p</a> <a id="1297" class="Symbol">:</a> <a id="1299" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="1307" href="Tactic.Eta.html#1295" class="Function">p</a> <a id="1309" class="Symbol">=</a> <a id="1311" class="Symbol">∀</a> <a id="1313" class="Symbol">{</a><a id="1314" href="Tactic.Eta.html#1314" class="Bound">n</a><a id="1315" class="Symbol">}</a> <a id="1317" class="Symbol">→</a> <a id="1319" href="Data.Fin.Base.html#1154" class="Datatype">Fin</a> <a id="1323" href="Tactic.Eta.html#1314" class="Bound">n</a>

    <a id="Test.∀p"></a><a id="1330" href="Tactic.Eta.html#1330" class="Function">∀p</a> <a id="1333" class="Symbol">:</a> <a id="1335" class="Symbol">∀</a> <a id="1337" class="Symbol">{</a><a id="1338" href="Tactic.Eta.html#1338" class="Bound">n</a><a id="1339" class="Symbol">}</a> <a id="1341" class="Symbol">→</a> <a id="1343" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="1351" href="Tactic.Eta.html#1330" class="Function">∀p</a> <a id="1354" class="Symbol">{</a><a id="1355" href="Tactic.Eta.html#1355" class="Bound">n</a><a id="1356" class="Symbol">}</a> <a id="1358" class="Symbol">=</a> <a id="1360" href="Data.Fin.Base.html#1154" class="Datatype">Fin</a> <a id="1364" href="Tactic.Eta.html#1355" class="Bound">n</a>

    <a id="1371" href="Tactic.Eta.html#1371" class="Function">_</a> <a id="1373" class="Symbol">:</a> <a id="1375" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="1383" class="Symbol">_</a> <a id="1385" class="Symbol">=</a> <a id="1387" href="Tactic.Eta.html#781" class="Macro">η</a> <a id="1389" href="Tactic.Eta.html#1330" class="Function">∀p</a>

    <a id="Test.∀kp"></a><a id="1397" href="Tactic.Eta.html#1397" class="Function">∀kp</a> <a id="1401" class="Symbol">:</a> <a id="1403" class="Symbol">∀</a> <a id="1405" class="Symbol">(</a><a id="1406" href="Tactic.Eta.html#1406" class="Bound">m</a> <a id="1408" class="Symbol">:</a> <a id="1410" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1411" class="Symbol">)</a> <a id="1413" class="Symbol">{</a><a id="1414" href="Tactic.Eta.html#1414" class="Bound">n</a><a id="1415" class="Symbol">}</a> <a id="1417" class="Symbol">→</a> <a id="1419" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="1427" href="Tactic.Eta.html#1397" class="Function">∀kp</a> <a id="1431" class="Symbol">_</a> <a id="1433" class="Symbol">{</a><a id="1434" href="Tactic.Eta.html#1434" class="Bound">n</a><a id="1435" class="Symbol">}</a> <a id="1437" class="Symbol">=</a> <a id="1439" href="Data.Fin.Base.html#1154" class="Datatype">Fin</a> <a id="1443" href="Tactic.Eta.html#1434" class="Bound">n</a>

    <a id="1450" href="Tactic.Eta.html#1450" class="Function">_</a> <a id="1452" class="Symbol">:</a> <a id="1454" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="1462" class="Symbol">_</a> <a id="1464" class="Symbol">=</a> <a id="1466" href="Tactic.Eta.html#781" class="Macro">η</a> <a id="1468" class="Symbol">(</a><a id="1469" href="Tactic.Eta.html#1397" class="Function">∀kp</a> <a id="1473" class="Number">0</a><a id="1474" class="Symbol">)</a>

    <a id="Test.∀k2p"></a><a id="1481" href="Tactic.Eta.html#1481" class="Function">∀k2p</a> <a id="1486" class="Symbol">:</a> <a id="1488" class="Symbol">∀</a> <a id="1490" class="Symbol">(</a><a id="1491" href="Tactic.Eta.html#1491" class="Bound">m</a> <a id="1493" class="Symbol">:</a> <a id="1495" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1496" class="Symbol">)</a> <a id="1498" class="Symbol">{</a><a id="1499" href="Tactic.Eta.html#1499" class="Bound">k</a> <a id="1501" class="Symbol">:</a> <a id="1503" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1504" class="Symbol">}</a> <a id="1506" class="Symbol">{</a><a id="1507" href="Tactic.Eta.html#1507" class="Bound">n</a><a id="1508" class="Symbol">}</a> <a id="1510" class="Symbol">→</a> <a id="1512" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="1520" href="Tactic.Eta.html#1481" class="Function">∀k2p</a> <a id="1525" class="Symbol">_</a> <a id="1527" class="Symbol">{</a><a id="1528" class="Argument">n</a> <a id="1530" class="Symbol">=</a> <a id="1532" href="Tactic.Eta.html#1532" class="Bound">n</a><a id="1533" class="Symbol">}</a> <a id="1535" class="Symbol">=</a> <a id="1537" href="Data.Fin.Base.html#1154" class="Datatype">Fin</a> <a id="1541" href="Tactic.Eta.html#1532" class="Bound">n</a>

    <a id="1548" href="Tactic.Eta.html#1548" class="Function">_</a> <a id="1550" class="Symbol">:</a> <a id="1552" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="1560" class="Symbol">_</a> <a id="1562" class="Symbol">=</a> <a id="1564" href="Tactic.Eta.html#781" class="Macro">η</a> <a id="1566" class="Symbol">(</a><a id="1567" href="Tactic.Eta.html#1481" class="Function">∀k2p</a> <a id="1572" class="Number">0</a> <a id="1574" class="Symbol">{</a><a id="1575" class="Number">1</a><a id="1576" class="Symbol">})</a>
</pre></body></html>