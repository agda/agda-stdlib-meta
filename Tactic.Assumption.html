<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Tactic.Assumption</title><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css'/><style>.github-fork-ribbon:before { background-color: #333; }</style><link rel="stylesheet" href="css/Agda.css"></head><body><a class='github-fork-ribbon'href='https://github.com/agda/agda-stdlib-meta/tree/master///Tactic/Assumption.agda'data-ribbon='Source code on Github' title='Source code on Github'>Source code on Github</a><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--safe</a> <a id="20" class="Pragma">--without-K</a> <a id="32" class="Symbol">#-}</a>
<a id="36" class="Comment">--------------------------------------------------------------------------------</a>
<a id="117" class="Comment">-- assumption: try to solve the goal with one of the available assumptions</a>
<a id="192" class="Comment">--------------------------------------------------------------------------------</a>

<a id="274" class="Keyword">module</a> <a id="281" href="Tactic.Assumption.html" class="Module">Tactic.Assumption</a> <a id="299" class="Keyword">where</a>

<a id="306" class="Keyword">open</a> <a id="311" class="Keyword">import</a> <a id="318" href="Meta.Prelude.html" class="Module">Meta.Prelude</a>
<a id="331" class="Keyword">open</a> <a id="336" class="Keyword">import</a> <a id="343" href="Meta.Init.html" class="Module">Meta.Init</a>

<a id="354" class="Keyword">open</a> <a id="359" class="Keyword">import</a> <a id="366" href="Class.Functor.html" class="Module">Class.Functor</a>
<a id="380" class="Keyword">open</a> <a id="385" class="Keyword">import</a> <a id="392" href="Class.Monad.html" class="Module">Class.Monad</a>
<a id="404" class="Keyword">open</a> <a id="409" class="Keyword">import</a> <a id="416" href="Class.MonadError.Instances.html" class="Module">Class.MonadError.Instances</a>
<a id="443" class="Keyword">open</a> <a id="448" class="Keyword">import</a> <a id="455" href="Class.MonadReader.Instances.html" class="Module">Class.MonadReader.Instances</a>
<a id="483" class="Keyword">open</a> <a id="488" class="Keyword">import</a> <a id="495" href="Class.MonadTC.Instances.html" class="Module">Class.MonadTC.Instances</a>

<a id="520" class="Keyword">open</a> <a id="525" class="Keyword">import</a> <a id="532" href="Reflection.Tactic.html" class="Module">Reflection.Tactic</a>
<a id="550" class="Keyword">open</a> <a id="555" class="Keyword">import</a> <a id="562" href="Reflection.Utils.html" class="Module">Reflection.Utils</a>
<a id="579" class="Keyword">open</a> <a id="584" class="Keyword">import</a> <a id="591" href="Reflection.Utils.TCI.html" class="Module">Reflection.Utils.TCI</a>

<a id="613" class="Keyword">instance</a>
  <a id="624" href="Tactic.Assumption.html#624" class="Function">_</a> <a id="626" class="Symbol">=</a> <a id="628" href="Class.Monad.Core.html#610" class="Function">Functor-M</a>

<a id="solve"></a><a id="639" href="Tactic.Assumption.html#639" class="Function">solve</a> <a id="645" class="Symbol">:</a> <a id="647" class="Symbol">⦃</a> <a id="649" href="Class.MonadTC.html#619" class="Record">TCOptions</a> <a id="659" class="Symbol">⦄</a> <a id="661" class="Symbol">→</a> <a id="663" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="668" class="Symbol">→</a> <a id="670" href="Reflection.Tactic.html#495" class="Function">Tactic</a>
<a id="677" href="Tactic.Assumption.html#639" class="Function">solve</a> <a id="683" href="Tactic.Assumption.html#683" class="Bound">t</a> <a id="685" class="Symbol">=</a> <a id="687" href="Reflection.Tactic.html#843" class="Function">initTac</a> <a id="695" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="697" href="Class.MonadTC.html#2435" class="Field">runSpeculative</a> <a id="712" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="714" class="Keyword">do</a>
  <a id="719" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="724" href="Tactic.Assumption.html#724" class="Bound">goal</a> <a id="729" href="Class.Monad.Core.html#290" class="Field Operator">←</a> <a id="731" href="Class.MonadReader.html#391" class="Function">reader</a> <a id="738" href="Class.MonadTC.html#1025" class="Field">TCEnv.goal</a>
    <a id="753" class="Keyword">where</a> <a id="759" class="CatchallClause Symbol">_</a> <a id="761" class="Symbol">→</a> <a id="763" href="Class.MonadTC.html#8772" class="Function">error1</a> <a id="770" class="String">&quot;solve: Goal is not a term!&quot;</a>
  <a id="801" href="Tactic.Assumption.html#801" class="Bound">metas</a> <a id="807" href="Class.Monad.Core.html#290" class="Field Operator">←</a> <a id="809" href="Reflection.Utils.html#1212" class="Function">findMetas</a> <a id="819" href="Class.Functor.Core.html#233" class="Field Operator">&lt;$&gt;</a> <a id="823" href="Class.MonadTC.html#1788" class="Field">checkType</a> <a id="833" href="Tactic.Assumption.html#683" class="Bound">t</a> <a id="835" href="Tactic.Assumption.html#724" class="Bound">goal</a>
  <a id="842" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="845" href="Data.List.Base.html#4703" class="Function">null</a> <a id="850" href="Tactic.Assumption.html#801" class="Bound">metas</a>
    <a id="860" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="865" class="Symbol">(</a><a id="866" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,</a> <a id="869" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a><a id="873" class="Symbol">)</a>  <a id="876" href="Class.Functor.Core.html#233" class="Field Operator">&lt;$&gt;</a> <a id="880" href="Class.MonadTC.html#1650" class="Field">unify</a> <a id="886" href="Tactic.Assumption.html#724" class="Bound">goal</a> <a id="891" href="Tactic.Assumption.html#683" class="Bound">t</a>
    <a id="897" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="902" class="Symbol">(</a><a id="903" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,</a> <a id="906" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a><a id="911" class="Symbol">)</a> <a id="913" href="Class.Functor.Core.html#233" class="Field Operator">&lt;$&gt;</a> <a id="917" href="Class.MonadTC.html#8772" class="Function">error1</a> <a id="924" class="String">&quot;Unsolved metavariables remaining!&quot;</a>

<a id="assumption&#39;"></a><a id="961" href="Tactic.Assumption.html#961" class="Function">assumption&#39;</a> <a id="973" class="Symbol">:</a> <a id="975" href="Reflection.Tactic.html#540" class="Function">ITactic</a>
<a id="983" href="Tactic.Assumption.html#961" class="Function">assumption&#39;</a> <a id="995" class="Symbol">=</a> <a id="997" href="Reflection.Utils.TCI.html#5951" class="Function">inDebugPath</a> <a id="1009" class="String">&quot;assumption&quot;</a> <a id="1022" class="Keyword">do</a>
  <a id="1027" href="Tactic.Assumption.html#1027" class="Bound">c</a> <a id="1029" href="Class.Monad.Core.html#290" class="Field Operator">←</a> <a id="1031" href="Class.MonadTC.html#8078" class="Function">getContext</a>
  <a id="1044" href="Data.List.Base.html#4249" class="Function">foldl</a> <a id="1050" class="Symbol">(λ</a> <a id="1053" href="Tactic.Assumption.html#1053" class="Bound">x</a> <a id="1055" href="Tactic.Assumption.html#1055" class="Bound">k</a> <a id="1057" class="Symbol">→</a> <a id="1059" class="Keyword">do</a>
    <a id="1066" href="Class.MonadError.html#364" class="Field">catch</a> <a id="1072" class="Symbol">(</a><a id="1073" href="Class.MonadTC.html#10522" class="Function">unifyWithGoal</a> <a id="1087" class="Symbol">(</a><a id="1088" href="Reflection.Syntax.html#1453" class="InductiveConstructor">♯</a> <a id="1090" href="Tactic.Assumption.html#1055" class="Bound">k</a><a id="1091" class="Symbol">)</a> <a id="1093" href="Class.Monad.Core.html#324" class="Function Operator">&gt;&gt;</a> <a id="1096" href="Class.MonadTC.html#5774" class="Function">debugLog</a> <a id="1105" class="Symbol">(</a><a id="1106" class="String">&quot;Success with: &quot;</a> <a id="1123" href="Reflection.Debug.html#1015" class="Function Operator">∷ᵈ</a> <a id="1126" href="Reflection.Syntax.html#1453" class="InductiveConstructor">♯</a> <a id="1128" href="Tactic.Assumption.html#1055" class="Bound">k</a> <a id="1130" href="Reflection.Debug.html#1015" class="Function Operator">∷ᵈ</a> <a id="1133" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1135" class="Symbol">))</a> <a id="1138" class="Symbol">(λ</a> <a id="1141" href="Tactic.Assumption.html#1141" class="Bound">_</a> <a id="1143" class="Symbol">→</a> <a id="1145" href="Tactic.Assumption.html#1053" class="Bound">x</a><a id="1146" class="Symbol">))</a>
    <a id="1153" class="Symbol">(</a><a id="1154" href="Class.MonadTC.html#8919" class="Function">logAndError1</a> <a id="1167" class="String">&quot;No valid assumption!&quot;</a><a id="1189" class="Symbol">)</a> <a id="1191" class="Symbol">(</a><a id="1192" href="Data.List.Base.html#6728" class="Function">downFrom</a> <a id="1201" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1203" href="Data.List.Base.html#5044" class="Function">length</a> <a id="1210" href="Tactic.Assumption.html#1027" class="Bound">c</a><a id="1211" class="Symbol">)</a>

<a id="1214" class="Keyword">module</a> <a id="1221" href="Tactic.Assumption.html#1221" class="Module">_</a> <a id="1223" class="Symbol">⦃</a> <a id="1225" href="Tactic.Assumption.html#1225" class="Bound">_</a> <a id="1227" class="Symbol">:</a> <a id="1229" href="Class.MonadTC.html#619" class="Record">TCOptions</a> <a id="1239" class="Symbol">⦄</a> <a id="1241" class="Keyword">where</a>
  <a id="1249" class="Keyword">macro</a>
    <a id="1259" href="Tactic.Assumption.html#1259" class="Function">assumption</a> <a id="1270" class="Symbol">=</a> <a id="1272" href="Reflection.Tactic.html#843" class="Function">initTac</a> <a id="1280" href="Tactic.Assumption.html#961" class="Function">assumption&#39;</a>
    <a id="1296" href="Tactic.Assumption.html#1296" class="Function">assumptionOpts</a> <a id="1311" class="Symbol">=</a> <a id="1313" href="Reflection.Tactic.html#682" class="Function">initTacOpts</a> <a id="1325" href="Tactic.Assumption.html#961" class="Function">assumption&#39;</a>

<a id="1338" class="Keyword">private</a>
  <a id="1348" class="Keyword">open</a> <a id="1353" class="Keyword">import</a> <a id="1360" href="Tactic.Defaults.html" class="Module">Tactic.Defaults</a>
  <a id="1378" class="Keyword">module</a> <a id="Test"></a><a id="1385" href="Tactic.Assumption.html#1385" class="Module">Test</a> <a id="1390" class="Keyword">where</a>
    <a id="Test.test₁"></a><a id="1400" href="Tactic.Assumption.html#1400" class="Function">test₁</a> <a id="1406" class="Symbol">:</a> <a id="1408" class="Symbol">{</a><a id="1409" href="Tactic.Assumption.html#1409" class="Bound">A</a> <a id="1411" href="Tactic.Assumption.html#1411" class="Bound">B</a> <a id="1413" class="Symbol">:</a> <a id="1415" href="Agda.Primitive.html#388" class="Primitive">Set</a><a id="1418" class="Symbol">}</a> <a id="1420" class="Symbol">→</a> <a id="1422" href="Tactic.Assumption.html#1409" class="Bound">A</a> <a id="1424" class="Symbol">→</a> <a id="1426" href="Tactic.Assumption.html#1411" class="Bound">B</a> <a id="1428" class="Symbol">→</a> <a id="1430" href="Tactic.Assumption.html#1409" class="Bound">A</a>
    <a id="1436" href="Tactic.Assumption.html#1400" class="Function">test₁</a> <a id="1442" href="Tactic.Assumption.html#1442" class="Bound">a</a> <a id="1444" href="Tactic.Assumption.html#1444" class="Bound">b</a> <a id="1446" class="Symbol">=</a> <a id="1448" href="Tactic.Assumption.html#1259" class="Macro">assumption</a>

    <a id="Test.test₂"></a><a id="1464" href="Tactic.Assumption.html#1464" class="Function">test₂</a> <a id="1470" class="Symbol">:</a> <a id="1472" class="Symbol">{</a><a id="1473" href="Tactic.Assumption.html#1473" class="Bound">A</a> <a id="1475" href="Tactic.Assumption.html#1475" class="Bound">B</a> <a id="1477" class="Symbol">:</a> <a id="1479" href="Agda.Primitive.html#388" class="Primitive">Set</a><a id="1482" class="Symbol">}</a> <a id="1484" class="Symbol">→</a> <a id="1486" href="Tactic.Assumption.html#1473" class="Bound">A</a> <a id="1488" class="Symbol">→</a> <a id="1490" href="Tactic.Assumption.html#1475" class="Bound">B</a> <a id="1492" class="Symbol">→</a> <a id="1494" href="Tactic.Assumption.html#1475" class="Bound">B</a>
    <a id="1500" href="Tactic.Assumption.html#1464" class="Function">test₂</a> <a id="1506" href="Tactic.Assumption.html#1506" class="Bound">a</a> <a id="1508" href="Tactic.Assumption.html#1508" class="Bound">b</a> <a id="1510" class="Symbol">=</a> <a id="1512" href="Tactic.Assumption.html#1259" class="Macro">assumption</a>
</pre></body></html>